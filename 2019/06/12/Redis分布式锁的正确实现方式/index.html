

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="Alterem">
  <meta name="keywords" content="Alterem">
  <title>Redisåˆ†å¸ƒå¼é”çš„æ­£ç¡®å®ç°æ–¹å¼ - Alterem</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/github-gist.min.css" />
    
  

  


<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_pf9vaxs7x7b.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->


  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 4.2.1"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Alterem</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                é¦–é¡µ
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                å½’æ¡£
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                åˆ†ç±»
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                æ ‡ç­¾
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                å…³äº
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner intro-2" id="background" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container page-header text-center fade-in-up">
            <span class="h2" id="subtitle">
              
            </span>
            <p id="hitokoto"> ... </p>
            <script>
              fetch('https://v1.hitokoto.cn')
                .then(response => response.json())
                .then(data => {
                  const hitokoto = document.getElementById('hitokoto')
                  hitokoto.innerText = ' ğŸš€ ' + data.hitokoto + ' â€”ã€Š' + data.from + 'ã€‹'
                }).catch(console.error)
            </script>
            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2019-06-12 00:41" pubdate>
        2019å¹´6æœˆ12æ—¥ å‡Œæ™¨
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      2.7k å­—
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      30
       åˆ†é’Ÿ
    </span>
  

  
  
    
      <!-- ä¸è’œå­ç»Ÿè®¡æ–‡ç« PV -->
      <span id="busuanzi_container_page_pv" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="busuanzi_value_page_pv"></span> æ¬¡
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto" id="post">
            <!-- SEO header -->
            <h1 style="display: none">Redisåˆ†å¸ƒå¼é”çš„æ­£ç¡®å®ç°æ–¹å¼</h1>
            
            <div class="markdown-body" id="post-body">
              <h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åˆ†å¸ƒå¼é”ä¸€èˆ¬æœ‰ä¸‰ç§å®ç°æ–¹å¼ï¼š1. æ•°æ®åº“ä¹è§‚é”ï¼›2. åŸºäºRedisçš„åˆ†å¸ƒå¼é”ï¼›3. åŸºäºZooKeeperçš„åˆ†å¸ƒå¼é”ã€‚æœ¬ç¯‡åšå®¢å°†ä»‹ç»ç¬¬äºŒç§æ–¹å¼ï¼ŒåŸºäºRediså®ç°åˆ†å¸ƒå¼é”ã€‚è™½ç„¶ç½‘ä¸Šå·²ç»æœ‰å„ç§ä»‹ç»Redisåˆ†å¸ƒå¼é”å®ç°çš„åšå®¢ï¼Œç„¶è€Œä»–ä»¬çš„å®ç°å´æœ‰ç€å„ç§å„æ ·çš„é—®é¢˜ï¼Œä¸ºäº†é¿å…è¯¯äººå­å¼Ÿï¼Œæœ¬ç¯‡åšå®¢å°†è¯¦ç»†ä»‹ç»å¦‚ä½•æ­£ç¡®åœ°å®ç°Redisåˆ†å¸ƒå¼é”ã€‚</p>
<hr>
<h2 id="å¯é æ€§"><a href="#å¯é æ€§" class="headerlink" title="å¯é æ€§"></a>å¯é æ€§</h2><a id="more"></a>

<p>é¦–å…ˆï¼Œä¸ºäº†ç¡®ä¿åˆ†å¸ƒå¼é”å¯ç”¨ï¼Œæˆ‘ä»¬è‡³å°‘è¦ç¡®ä¿é”çš„å®ç°åŒæ—¶æ»¡è¶³ä»¥ä¸‹å››ä¸ªæ¡ä»¶ï¼š</p>
<ul>
<li>äº’æ–¥æ€§ã€‚åœ¨ä»»æ„æ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯èƒ½æŒæœ‰é”ã€‚</li>
<li>ä¸ä¼šå‘ç”Ÿæ­»é”ã€‚å³ä½¿æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯åœ¨æŒæœ‰é”çš„æœŸé—´å´©æºƒè€Œæ²¡æœ‰ä¸»åŠ¨è§£é”ï¼Œä¹Ÿèƒ½ä¿è¯åç»­å…¶ä»–å®¢æˆ·ç«¯èƒ½åŠ é”ã€‚</li>
<li>å…·æœ‰å®¹é”™æ€§ã€‚åªè¦å¤§éƒ¨åˆ†çš„RedisèŠ‚ç‚¹æ­£å¸¸è¿è¡Œï¼Œå®¢æˆ·ç«¯å°±å¯ä»¥åŠ é”å’Œè§£é”ã€‚</li>
<li>è§£é“ƒè¿˜é¡»ç³»é“ƒäººã€‚åŠ é”å’Œè§£é”å¿…é¡»æ˜¯åŒä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯è‡ªå·±ä¸èƒ½æŠŠåˆ«äººåŠ çš„é”ç»™è§£äº†ã€‚</li>
</ul>
<h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><h3 id="ç»„ä»¶ä¾èµ–"><a href="#ç»„ä»¶ä¾èµ–" class="headerlink" title="ç»„ä»¶ä¾èµ–"></a>ç»„ä»¶ä¾èµ–</h3><p>é¦–å…ˆæˆ‘ä»¬è¦é€šè¿‡Mavenå¼•å…¥Jediså¼€æºç»„ä»¶ï¼Œåœ¨pom.xmlæ–‡ä»¶åŠ å…¥ä¸‹é¢çš„ä»£ç ï¼š</p>
<pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>redis.clients<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jedis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.9.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>

<h3 id="åŠ é”ä»£ç "><a href="#åŠ é”ä»£ç " class="headerlink" title="åŠ é”ä»£ç "></a>åŠ é”ä»£ç </h3><h4 id="æ­£ç¡®å§¿åŠ¿"><a href="#æ­£ç¡®å§¿åŠ¿" class="headerlink" title="æ­£ç¡®å§¿åŠ¿"></a>æ­£ç¡®å§¿åŠ¿</h4><p>Talk is cheap, show me the codeã€‚å…ˆå±•ç¤ºä»£ç ï¼Œå†å¸¦å¤§å®¶æ…¢æ…¢è§£é‡Šä¸ºä»€ä¹ˆè¿™æ ·å®ç°ï¼š</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RedisTool</span> </span>&#123;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String LOCK_SUCCESS = <span class="hljs-string">"OK"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String SET_IF_NOT_EXIST = <span class="hljs-string">"NX"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String SET_WITH_EXPIRE_TIME = <span class="hljs-string">"PX"</span>;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * å°è¯•è·å–åˆ†å¸ƒå¼é”</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> jedis Rediså®¢æˆ·ç«¯</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> lockKey é”</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> requestId è¯·æ±‚æ ‡è¯†</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> expireTime è¶…æœŸæ—¶é—´</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@return</span> æ˜¯å¦è·å–æˆåŠŸ</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">tryGetDistributedLock</span><span class="hljs-params">(Jedis jedis, String lockKey, String requestId, <span class="hljs-keyword">int</span> expireTime)</span> </span>&#123;

        String result = jedis.set(lockKey, requestId, SET_IF_NOT_EXIST, SET_WITH_EXPIRE_TIME, expireTime);

        <span class="hljs-keyword">if</span> (LOCK_SUCCESS.equals(result)) &#123;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
        &#125;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
    &#125;
&#125;</code></pre>

<p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åŠ é”å°±ä¸€è¡Œä»£ç ï¼šjedis.set(String key, String value, String nxxx, String expx, int time)ï¼Œè¿™ä¸ªset()æ–¹æ³•ä¸€å…±æœ‰äº”ä¸ªå½¢å‚ï¼š</p>
<p><strong>ç¬¬ä¸€ä¸ªä¸ºkey</strong>ï¼Œæˆ‘ä»¬ä½¿ç”¨keyæ¥å½“é”ï¼Œå› ä¸ºkeyæ˜¯å”¯ä¸€çš„ã€‚</p>
<p><strong>ç¬¬äºŒä¸ªä¸ºvalue</strong>ï¼Œæˆ‘ä»¬ä¼ çš„æ˜¯requestIdï¼Œå¾ˆå¤šç«¥é‹å¯èƒ½ä¸æ˜ç™½ï¼Œæœ‰keyä½œä¸ºé”ä¸å°±å¤Ÿäº†å—ï¼Œä¸ºä»€ä¹ˆè¿˜è¦ç”¨åˆ°valueï¼ŸåŸå› å°±æ˜¯æˆ‘ä»¬åœ¨ä¸Šé¢è®²åˆ°å¯é æ€§æ—¶ï¼Œåˆ†å¸ƒå¼é”è¦æ»¡è¶³ç¬¬å››ä¸ªæ¡ä»¶è§£é“ƒè¿˜é¡»ç³»é“ƒäººï¼Œé€šè¿‡ç»™valueèµ‹å€¼ä¸ºrequestIdï¼Œæˆ‘ä»¬å°±çŸ¥é“è¿™æŠŠé”æ˜¯å“ªä¸ªè¯·æ±‚åŠ çš„äº†ï¼Œåœ¨è§£é”çš„æ—¶å€™å°±å¯ä»¥æœ‰ä¾æ®ã€‚requestIdå¯ä»¥ä½¿ç”¨UUID.randomUUID().toString()æ–¹æ³•ç”Ÿæˆã€‚</p>
<p><strong>ç¬¬ä¸‰ä¸ªä¸ºnxxx</strong>ï¼Œè¿™ä¸ªå‚æ•°æˆ‘ä»¬å¡«çš„æ˜¯NXï¼Œæ„æ€æ˜¯SET IF NOT EXISTï¼Œå³å½“keyä¸å­˜åœ¨æ—¶ï¼Œæˆ‘ä»¬è¿›è¡Œsetæ“ä½œï¼›è‹¥keyå·²ç»å­˜åœ¨ï¼Œåˆ™ä¸åšä»»ä½•æ“ä½œï¼›</p>
<p><strong>ç¬¬å››ä¸ªä¸ºexpx</strong>ï¼Œè¿™ä¸ªå‚æ•°æˆ‘ä»¬ä¼ çš„æ˜¯PXï¼Œæ„æ€æ˜¯æˆ‘ä»¬è¦ç»™è¿™ä¸ªkeyåŠ ä¸€ä¸ªè¿‡æœŸçš„è®¾ç½®ï¼Œå…·ä½“æ—¶é—´ç”±ç¬¬äº”ä¸ªå‚æ•°å†³å®šã€‚</p>
<p><strong>ç¬¬äº”ä¸ªä¸ºtime</strong>ï¼Œä¸ç¬¬å››ä¸ªå‚æ•°ç›¸å‘¼åº”ï¼Œä»£è¡¨keyçš„è¿‡æœŸæ—¶é—´ã€‚</p>
<p>æ€»çš„æ¥è¯´ï¼Œæ‰§è¡Œä¸Šé¢çš„set()æ–¹æ³•å°±åªä¼šå¯¼è‡´ä¸¤ç§ç»“æœï¼š</p>
<ol>
<li>å½“å‰æ²¡æœ‰é”ï¼ˆkeyä¸å­˜åœ¨ï¼‰ï¼Œé‚£ä¹ˆå°±è¿›è¡ŒåŠ é”æ“ä½œï¼Œå¹¶å¯¹é”è®¾ç½®ä¸ªæœ‰æ•ˆæœŸï¼ŒåŒæ—¶valueè¡¨ç¤ºåŠ é”çš„å®¢æˆ·ç«¯ã€‚</li>
<li>å·²æœ‰é”å­˜åœ¨ï¼Œä¸åšä»»ä½•æ“ä½œã€‚</li>
</ol>
<p>å¿ƒç»†çš„ç«¥é‹å°±ä¼šå‘ç°äº†ï¼Œæˆ‘ä»¬çš„åŠ é”ä»£ç æ»¡è¶³æˆ‘ä»¬å¯é æ€§é‡Œæè¿°çš„ä¸‰ä¸ªæ¡ä»¶ã€‚é¦–å…ˆï¼Œset()åŠ å…¥äº†NXå‚æ•°ï¼Œå¯ä»¥ä¿è¯å¦‚æœå·²æœ‰keyå­˜åœ¨ï¼Œåˆ™å‡½æ•°ä¸ä¼šè°ƒç”¨æˆåŠŸï¼Œä¹Ÿå°±æ˜¯åªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯èƒ½æŒæœ‰é”ï¼Œæ»¡è¶³äº’æ–¥æ€§ã€‚å…¶æ¬¡ï¼Œç”±äºæˆ‘ä»¬å¯¹é”è®¾ç½®äº†è¿‡æœŸæ—¶é—´ï¼Œå³ä½¿é”çš„æŒæœ‰è€…åç»­å‘ç”Ÿå´©æºƒè€Œæ²¡æœ‰è§£é”ï¼Œé”ä¹Ÿä¼šå› ä¸ºåˆ°äº†è¿‡æœŸæ—¶é—´è€Œè‡ªåŠ¨è§£é”ï¼ˆå³keyè¢«åˆ é™¤ï¼‰ï¼Œä¸ä¼šå‘ç”Ÿæ­»é”ã€‚</p>
<p>æœ€åï¼Œå› ä¸ºæˆ‘ä»¬å°†valueèµ‹å€¼ä¸ºrequestIdï¼Œä»£è¡¨åŠ é”çš„å®¢æˆ·ç«¯è¯·æ±‚æ ‡è¯†ï¼Œé‚£ä¹ˆåœ¨å®¢æˆ·ç«¯åœ¨è§£é”çš„æ—¶å€™å°±å¯ä»¥è¿›è¡Œæ ¡éªŒæ˜¯å¦æ˜¯åŒä¸€ä¸ªå®¢æˆ·ç«¯ã€‚ç”±äºæˆ‘ä»¬åªè€ƒè™‘Rediså•æœºéƒ¨ç½²çš„åœºæ™¯ï¼Œæ‰€ä»¥å®¹é”™æ€§æˆ‘ä»¬æš‚ä¸è€ƒè™‘ã€‚</p>
<h4 id="é”™è¯¯ç¤ºä¾‹1"><a href="#é”™è¯¯ç¤ºä¾‹1" class="headerlink" title="é”™è¯¯ç¤ºä¾‹1"></a>é”™è¯¯ç¤ºä¾‹1</h4><p>æ¯”è¾ƒå¸¸è§çš„é”™è¯¯ç¤ºä¾‹å°±æ˜¯ä½¿ç”¨jedis.setnx()å’Œjedis.expire()ç»„åˆå®ç°åŠ é”ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">wrongGetLock1</span><span class="hljs-params">(Jedis jedis, String lockKey, String requestId, <span class="hljs-keyword">int</span> expireTime)</span> </span>&#123;

    Long result = jedis.setnx(lockKey, requestId);
    <span class="hljs-keyword">if</span> (result == <span class="hljs-number">1</span>) &#123;
        <span class="hljs-comment">// è‹¥åœ¨è¿™é‡Œç¨‹åºçªç„¶å´©æºƒï¼Œåˆ™æ— æ³•è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå°†å‘ç”Ÿæ­»é”</span>
        jedis.expire(lockKey, expireTime);
    &#125;
&#125;</code></pre>

<p>setnx()æ–¹æ³•ä½œç”¨å°±æ˜¯SET IF NOT EXISTï¼Œexpire()æ–¹æ³•å°±æ˜¯ç»™é”åŠ ä¸€ä¸ªè¿‡æœŸæ—¶é—´ã€‚ä¹ä¸€çœ‹å¥½åƒå’Œå‰é¢çš„set()æ–¹æ³•ç»“æœä¸€æ ·ï¼Œç„¶è€Œç”±äºè¿™æ˜¯ä¸¤æ¡Rediså‘½ä»¤ï¼Œä¸å…·æœ‰åŸå­æ€§ï¼Œå¦‚æœç¨‹åºåœ¨æ‰§è¡Œå®Œsetnx()ä¹‹åçªç„¶å´©æºƒï¼Œå¯¼è‡´é”æ²¡æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´ã€‚é‚£ä¹ˆå°†ä¼šå‘ç”Ÿæ­»é”ã€‚ç½‘ä¸Šä¹‹æ‰€ä»¥æœ‰äººè¿™æ ·å®ç°ï¼Œæ˜¯å› ä¸ºä½ç‰ˆæœ¬çš„jediså¹¶ä¸æ”¯æŒå¤šå‚æ•°çš„set()æ–¹æ³•ã€‚</p>
<h4 id="é”™è¯¯ç¤ºä¾‹2"><a href="#é”™è¯¯ç¤ºä¾‹2" class="headerlink" title="é”™è¯¯ç¤ºä¾‹2"></a>é”™è¯¯ç¤ºä¾‹2</h4><p>è¿™ä¸€ç§é”™è¯¯ç¤ºä¾‹å°±æ¯”è¾ƒéš¾ä»¥å‘ç°é—®é¢˜ï¼Œè€Œä¸”å®ç°ä¹Ÿæ¯”è¾ƒå¤æ‚ã€‚å®ç°æ€è·¯ï¼šä½¿ç”¨jedis.setnx()å‘½ä»¤å®ç°åŠ é”ï¼Œå…¶ä¸­keyæ˜¯é”ï¼Œvalueæ˜¯é”çš„è¿‡æœŸæ—¶é—´ã€‚</p>
<p>æ‰§è¡Œè¿‡ç¨‹ï¼š</p>
<ol>
<li>é€šè¿‡setnx()æ–¹æ³•å°è¯•åŠ é”ï¼Œå¦‚æœå½“å‰é”ä¸å­˜åœ¨ï¼Œè¿”å›åŠ é”æˆåŠŸã€‚</li>
<li>å¦‚æœé”å·²ç»å­˜åœ¨åˆ™è·å–é”çš„è¿‡æœŸæ—¶é—´ï¼Œå’Œå½“å‰æ—¶é—´æ¯”è¾ƒï¼Œå¦‚æœé”å·²ç»è¿‡æœŸï¼Œåˆ™è®¾ç½®æ–°çš„è¿‡æœŸæ—¶é—´ï¼Œè¿”å›åŠ é”æˆåŠŸã€‚</li>
</ol>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">wrongGetLock2</span><span class="hljs-params">(Jedis jedis, String lockKey, <span class="hljs-keyword">int</span> expireTime)</span> </span>&#123;

    <span class="hljs-keyword">long</span> expires = System.currentTimeMillis() + expireTime;
    String expiresStr = String.valueOf(expires);

    <span class="hljs-comment">// å¦‚æœå½“å‰é”ä¸å­˜åœ¨ï¼Œè¿”å›åŠ é”æˆåŠŸ</span>
    <span class="hljs-keyword">if</span> (jedis.setnx(lockKey, expiresStr) == <span class="hljs-number">1</span>) &#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    &#125;

    <span class="hljs-comment">// å¦‚æœé”å­˜åœ¨ï¼Œè·å–é”çš„è¿‡æœŸæ—¶é—´</span>
    String currentValueStr = jedis.get(lockKey);
    <span class="hljs-keyword">if</span> (currentValueStr != <span class="hljs-keyword">null</span> &amp;&amp; Long.parseLong(currentValueStr) &lt; System.currentTimeMillis()) &#123;
        <span class="hljs-comment">// é”å·²è¿‡æœŸï¼Œè·å–ä¸Šä¸€ä¸ªé”çš„è¿‡æœŸæ—¶é—´ï¼Œå¹¶è®¾ç½®ç°åœ¨é”çš„è¿‡æœŸæ—¶é—´</span>
        String oldValueStr = jedis.getSet(lockKey, expiresStr);
        <span class="hljs-keyword">if</span> (oldValueStr != <span class="hljs-keyword">null</span> &amp;&amp; oldValueStr.equals(currentValueStr)) &#123;
            <span class="hljs-comment">// è€ƒè™‘å¤šçº¿ç¨‹å¹¶å‘çš„æƒ…å†µï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„è®¾ç½®å€¼å’Œå½“å‰å€¼ç›¸åŒï¼Œå®ƒæ‰æœ‰æƒåˆ©åŠ é”</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
        &#125;
    &#125;

    <span class="hljs-comment">// å…¶ä»–æƒ…å†µï¼Œä¸€å¾‹è¿”å›åŠ é”å¤±è´¥</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;

&#125;</code></pre>

<p>é‚£ä¹ˆè¿™æ®µä»£ç é—®é¢˜åœ¨å“ªé‡Œï¼Ÿ1. ç”±äºæ˜¯å®¢æˆ·ç«¯è‡ªå·±ç”Ÿæˆè¿‡æœŸæ—¶é—´ï¼Œæ‰€ä»¥éœ€è¦å¼ºåˆ¶è¦æ±‚åˆ†å¸ƒå¼ä¸‹æ¯ä¸ªå®¢æˆ·ç«¯çš„æ—¶é—´å¿…é¡»åŒæ­¥ã€‚ 2. å½“é”è¿‡æœŸçš„æ—¶å€™ï¼Œå¦‚æœå¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶æ‰§è¡Œjedis.getSet()æ–¹æ³•ï¼Œé‚£ä¹ˆè™½ç„¶æœ€ç»ˆåªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯å¯ä»¥åŠ é”ï¼Œä½†æ˜¯è¿™ä¸ªå®¢æˆ·ç«¯çš„é”çš„è¿‡æœŸæ—¶é—´å¯èƒ½è¢«å…¶ä»–å®¢æˆ·ç«¯è¦†ç›–ã€‚3. é”ä¸å…·å¤‡æ‹¥æœ‰è€…æ ‡è¯†ï¼Œå³ä»»ä½•å®¢æˆ·ç«¯éƒ½å¯ä»¥è§£é”ã€‚</p>
<h3 id="è§£é”ä»£ç "><a href="#è§£é”ä»£ç " class="headerlink" title="è§£é”ä»£ç "></a>è§£é”ä»£ç </h3><h4 id="æ­£ç¡®å§¿åŠ¿-1"><a href="#æ­£ç¡®å§¿åŠ¿-1" class="headerlink" title="æ­£ç¡®å§¿åŠ¿"></a>æ­£ç¡®å§¿åŠ¿</h4><p>è¿˜æ˜¯å…ˆå±•ç¤ºä»£ç ï¼Œå†å¸¦å¤§å®¶æ…¢æ…¢è§£é‡Šä¸ºä»€ä¹ˆè¿™æ ·å®ç°ï¼š</p>
<pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RedisTool</span> </span>&#123;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Long RELEASE_SUCCESS = <span class="hljs-number">1L</span>;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * é‡Šæ”¾åˆ†å¸ƒå¼é”</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> jedis Rediså®¢æˆ·ç«¯</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> lockKey é”</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> requestId è¯·æ±‚æ ‡è¯†</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@return</span> æ˜¯å¦é‡Šæ”¾æˆåŠŸ</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">releaseDistributedLock</span><span class="hljs-params">(Jedis jedis, String lockKey, String requestId)</span> </span>&#123;

        String script = <span class="hljs-string">"if redis.call('get', KEYS[1]) == ARGV[1] then return redis.call('del', KEYS[1]) else return 0 end"</span>;
        Object result = jedis.eval(script, Collections.singletonList(lockKey), Collections.singletonList(requestId));

        <span class="hljs-keyword">if</span> (RELEASE_SUCCESS.equals(result)) &#123;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
        &#125;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;

    &#125;

&#125;</code></pre>

<p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬è§£é”åªéœ€è¦ä¸¤è¡Œä»£ç å°±æå®šäº†ï¼ç¬¬ä¸€è¡Œä»£ç ï¼Œæˆ‘ä»¬å†™äº†ä¸€ä¸ªç®€å•çš„Luaè„šæœ¬ä»£ç ï¼Œä¸Šä¸€æ¬¡è§åˆ°è¿™ä¸ªç¼–ç¨‹è¯­è¨€è¿˜æ˜¯åœ¨ã€Šé»‘å®¢ä¸ç”»å®¶ã€‹é‡Œï¼Œæ²¡æƒ³åˆ°è¿™æ¬¡å±…ç„¶ç”¨ä¸Šäº†ã€‚ç¬¬äºŒè¡Œä»£ç ï¼Œæˆ‘ä»¬å°†Luaä»£ç ä¼ åˆ°jedis.eval()æ–¹æ³•é‡Œï¼Œå¹¶ä½¿å‚æ•°KEYS[1]èµ‹å€¼ä¸ºlockKeyï¼ŒARGV[1]èµ‹å€¼ä¸ºrequestIdã€‚eval()æ–¹æ³•æ˜¯å°†Luaä»£ç äº¤ç»™RedisæœåŠ¡ç«¯æ‰§è¡Œã€‚</p>
<p>é‚£ä¹ˆè¿™æ®µLuaä»£ç çš„åŠŸèƒ½æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå…¶å®å¾ˆç®€å•ï¼Œé¦–å…ˆè·å–é”å¯¹åº”çš„valueå€¼ï¼Œæ£€æŸ¥æ˜¯å¦ä¸requestIdç›¸ç­‰ï¼Œå¦‚æœç›¸ç­‰åˆ™åˆ é™¤é”ï¼ˆè§£é”ï¼‰ã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆè¦ä½¿ç”¨Luaè¯­è¨€æ¥å®ç°å‘¢ï¼Ÿå› ä¸ºè¦ç¡®ä¿ä¸Šè¿°æ“ä½œæ˜¯åŸå­æ€§çš„ã€‚å…³äºéåŸå­æ€§ä¼šå¸¦æ¥ä»€ä¹ˆé—®é¢˜ï¼Œå¯ä»¥é˜…è¯»ã€è§£é”ä»£ç -é”™è¯¯ç¤ºä¾‹2ã€‘ ã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆæ‰§è¡Œeval()æ–¹æ³•å¯ä»¥ç¡®ä¿åŸå­æ€§ï¼ŒæºäºRedisçš„ç‰¹æ€§ï¼Œä¸‹é¢æ˜¯å®˜ç½‘å¯¹evalå‘½ä»¤çš„éƒ¨åˆ†è§£é‡Šï¼š</p>
<p>ç®€å•æ¥è¯´ï¼Œå°±æ˜¯åœ¨evalå‘½ä»¤æ‰§è¡ŒLuaä»£ç çš„æ—¶å€™ï¼ŒLuaä»£ç å°†è¢«å½“æˆä¸€ä¸ªå‘½ä»¤å»æ‰§è¡Œï¼Œå¹¶ä¸”ç›´åˆ°evalå‘½ä»¤æ‰§è¡Œå®Œæˆï¼ŒRedisæ‰ä¼šæ‰§è¡Œå…¶ä»–å‘½ä»¤ã€‚</p>
<h4 id="é”™è¯¯ç¤ºä¾‹1-1"><a href="#é”™è¯¯ç¤ºä¾‹1-1" class="headerlink" title="é”™è¯¯ç¤ºä¾‹1"></a>é”™è¯¯ç¤ºä¾‹1</h4><p>æœ€å¸¸è§çš„è§£é”ä»£ç å°±æ˜¯ç›´æ¥ä½¿ç”¨jedis.del()æ–¹æ³•åˆ é™¤é”ï¼Œè¿™ç§ä¸å…ˆåˆ¤æ–­é”çš„æ‹¥æœ‰è€…è€Œç›´æ¥è§£é”çš„æ–¹å¼ï¼Œä¼šå¯¼è‡´ä»»ä½•å®¢æˆ·ç«¯éƒ½å¯ä»¥éšæ—¶è¿›è¡Œè§£é”ï¼Œå³ä½¿è¿™æŠŠé”ä¸æ˜¯å®ƒçš„ã€‚</p>
<pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">wrongReleaseLock1</span><span class="hljs-params">(Jedis jedis, String lockKey)</span> </span>&#123;
    jedis.del(lockKey);
&#125;</code></pre>

<h4 id="é”™è¯¯ç¤ºä¾‹2-1"><a href="#é”™è¯¯ç¤ºä¾‹2-1" class="headerlink" title="é”™è¯¯ç¤ºä¾‹2"></a>é”™è¯¯ç¤ºä¾‹2</h4><p>è¿™ç§è§£é”ä»£ç ä¹ä¸€çœ‹ä¹Ÿæ˜¯æ²¡é—®é¢˜ï¼Œç”šè‡³æˆ‘ä¹‹å‰ä¹Ÿå·®ç‚¹è¿™æ ·å®ç°ï¼Œä¸æ­£ç¡®å§¿åŠ¿å·®ä¸å¤šï¼Œå”¯ä¸€åŒºåˆ«çš„æ˜¯åˆ†æˆä¸¤æ¡å‘½ä»¤å»æ‰§è¡Œï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">wrongReleaseLock2</span><span class="hljs-params">(Jedis jedis, String lockKey, String requestId)</span> </span>&#123;

    <span class="hljs-comment">// åˆ¤æ–­åŠ é”ä¸è§£é”æ˜¯ä¸æ˜¯åŒä¸€ä¸ªå®¢æˆ·ç«¯</span>
    <span class="hljs-keyword">if</span> (requestId.equals(jedis.get(lockKey))) &#123;
        <span class="hljs-comment">// è‹¥åœ¨æ­¤æ—¶ï¼Œè¿™æŠŠé”çªç„¶ä¸æ˜¯è¿™ä¸ªå®¢æˆ·ç«¯çš„ï¼Œåˆ™ä¼šè¯¯è§£é”</span>
        jedis.del(lockKey);
    &#125;

&#125;</code></pre>

<p>å¦‚ä»£ç æ³¨é‡Šï¼Œé—®é¢˜åœ¨äºå¦‚æœè°ƒç”¨jedis.del()æ–¹æ³•çš„æ—¶å€™ï¼Œè¿™æŠŠé”å·²ç»ä¸å±äºå½“å‰å®¢æˆ·ç«¯çš„æ—¶å€™ä¼šè§£é™¤ä»–äººåŠ çš„é”ã€‚é‚£ä¹ˆæ˜¯å¦çœŸçš„æœ‰è¿™ç§åœºæ™¯ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œæ¯”å¦‚å®¢æˆ·ç«¯AåŠ é”ï¼Œä¸€æ®µæ—¶é—´ä¹‹åå®¢æˆ·ç«¯Aè§£é”ï¼Œåœ¨æ‰§è¡Œjedis.del()ä¹‹å‰ï¼Œé”çªç„¶è¿‡æœŸäº†ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯Bå°è¯•åŠ é”æˆåŠŸï¼Œç„¶åå®¢æˆ·ç«¯Aå†æ‰§è¡Œdel()æ–¹æ³•ï¼Œåˆ™å°†å®¢æˆ·ç«¯Bçš„é”ç»™è§£é™¤äº†ã€‚</p>
<hr>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬æ–‡ä¸»è¦ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨Javaä»£ç æ­£ç¡®å®ç°Redisåˆ†å¸ƒå¼é”ï¼Œå¯¹äºåŠ é”å’Œè§£é”ä¹Ÿåˆ†åˆ«ç»™å‡ºäº†ä¸¤ä¸ªæ¯”è¾ƒç»å…¸çš„é”™è¯¯ç¤ºä¾‹ã€‚å…¶å®æƒ³è¦é€šè¿‡Rediså®ç°åˆ†å¸ƒå¼é”å¹¶ä¸éš¾ï¼Œåªè¦ä¿è¯èƒ½æ»¡è¶³å¯é æ€§é‡Œçš„å››ä¸ªæ¡ä»¶ã€‚äº’è”ç½‘è™½ç„¶ç»™æˆ‘ä»¬å¸¦æ¥äº†æ–¹ä¾¿ï¼Œåªè¦æœ‰é—®é¢˜å°±å¯ä»¥googleï¼Œç„¶è€Œç½‘ä¸Šçš„ç­”æ¡ˆä¸€å®šæ˜¯å¯¹çš„å—ï¼Ÿå…¶å®ä¸ç„¶ï¼Œæ‰€ä»¥æˆ‘ä»¬æ›´åº”è¯¥æ—¶åˆ»ä¿æŒç€è´¨ç–‘ç²¾ç¥ï¼Œå¤šæƒ³å¤šéªŒè¯ã€‚</p>
<p>å¦‚æœä½ çš„é¡¹ç›®ä¸­Redisæ˜¯å¤šæœºéƒ¨ç½²çš„ï¼Œé‚£ä¹ˆå¯ä»¥å°è¯•ä½¿ç”¨Redissonå®ç°åˆ†å¸ƒå¼é”ï¼Œè¿™æ˜¯Rediså®˜æ–¹æä¾›çš„Javaç»„ä»¶ã€‚</p>
<p><strong>æ¬¢è¿å…³æ³¨å¾®ä¿¡å…¬ä¼—å·â€‹ï¼š</strong></p>
<img src="https://gitee.com/alterem/picFB/raw/master/pics/2020/04/07/006y8mN6gy1g7d3llw1nkj30b40b4wee.jpg" srcset="/img/loading.gif" alt="æ¬¢è¿å…³æ³¨å…¬ä¼—å·" style="width: 100px" />
            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/Redis/">Redis</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/Redis/">Redis</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" target="_blank" rel="nofollow noopener noopener">CC BY-SA 4.0 åè®®</a> ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p>
              
              
                <div class="post-prevnext row">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2019/06/12/Java%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E6%9C%80%E5%B8%B8%E7%8A%AF%E7%9A%8410%E4%B8%AA%E9%94%99%E8%AF%AF/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Javaå¼€å‘äººå‘˜æœ€å¸¸çŠ¯çš„10ä¸ªé”™è¯¯</span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2019/06/12/Brew%E5%AE%89%E8%A3%85%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6/">
                        <span class="hidden-mobile">Brewå®‰è£…å¸¸ç”¨è½¯ä»¶</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p>
  <div id="tocbot"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  
    <!-- APlayer éŸ³ä¹æ’­æ”¾å™¨ -->
    <div id="aplayer"></div>
    <script defer src="https://cdn.staticfile.org/aplayer/1.10.1/APlayer.min.js" ></script>
<link  rel="stylesheet" href="https://cdn.staticfile.org/aplayer/1.10.1/APlayer.min.css" />
<script type="text/javascript">
  var oldLoadAp = window.onload;
  window.onload = function () {
    oldLoadAp && oldLoadAp();

    new APlayer({
      container: document.getElementById('aplayer'),
      fixed: true,
      autoplay: 'false' === 'true',
      loop: 'all',
      order: 'random',
      theme: '#b7daff',
      preload: 'none',
      audio: [{"name":"ä¿¡ä»°","artist":"å¼ ä¿¡å“²","url":"http://music.163.com/song/media/outer/url?id=402073804.mp3","cover":"https://gitee.com/alterem/picFB/raw/master/pics/2020/05/26/KVZW9j.jpg"},{"name":"åˆ«æ€•æˆ‘ä¼¤å¿ƒ","artist":"å¼ ä¿¡å“²","url":"http://music.163.com/song/media/outer/url?id=186385.mp3","cover":"https://gitee.com/alterem/picFB/raw/master/pics/2020/05/26/KVZW9j.jpg"},{"name":"éš¾ä»¥æŠ—æ‹’ä½ å®¹é¢œ","artist":"å¼ ä¿¡å“²","url":"http://music.163.com/song/media/outer/url?id=186383.mp3","cover":"http://p2.music.126.net/D0e4NZrx_0ArL5FhIXpJww==/109951163511560406.jpg"},{"name":"å£°å£°æ…¢","artist":"å‚¬å¼€æ½®","url":"http://music.163.com/song/media/outer/url?id=439139384.mp3","cover":"http://p1.music.126.net/qMiFV8V6zlOSS9D4FLwFMw==/109951162807427178.jpg"}]
    });
  }
</script>

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a>
      <i class="iconfont icon-love"></i>
      <span>Fluid</span>
    </div>
    
  <div class="statistics">
    
    

    
      
        <!-- ä¸è’œå­ç»Ÿè®¡PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            æ€»è®¿é—®é‡ 
            <span id="busuanzi_value_site_pv"></span>
             æ¬¡
          </span>
      
      
        <!-- ä¸è’œå­ç»Ÿè®¡UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            æ€»è®¿å®¢æ•° 
            <span id="busuanzi_value_site_uv"></span>
             äºº
          </span>
      
    
  </div>


    

    
  </div>
</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/main.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/js/clipboard-use.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





  <script  src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: '#post-body',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "Redisåˆ†å¸ƒå¼é”çš„æ­£ç¡®å®ç°æ–¹å¼&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>







  
  
    <script>
      !function (e, t, a) {
        function r() {
          for (var e = 0; e < s.length; e++) s[e].alpha <= 0 ? (t.body.removeChild(s[e].el), s.splice(e, 1)) : (s[e].y--, s[e].scale += .004, s[e].alpha -= .013, s[e].el.style.cssText = "left:" + s[e].x + "px;top:" + s[e].y + "px;opacity:" + s[e].alpha + ";transform:scale(" + s[e].scale + "," + s[e].scale + ") rotate(45deg);background:" + s[e].color + ";z-index:99999");
          requestAnimationFrame(r)
        }

        function n() {
          var t = "function" == typeof e.onclick && e.onclick;
          e.onclick = function (e) {
            t && t(), o(e)
          }
        }

        function o(e) {
          var a = t.createElement("div");
          a.className = "heart", s.push({
            el: a,
            x: e.clientX - 5,
            y: e.clientY - 5,
            scale: 1,
            alpha: 1,
            color: c()
          }), t.body.appendChild(a)
        }

        function i(e) {
          var a = t.createElement("style");
          a.type = "text/css";
          try {
            a.appendChild(t.createTextNode(e))
          } catch (t) {
            a.styleSheet.cssText = e
          }
          t.getElementsByTagName("head")[0].appendChild(a)
        }

        function c() {
          return "rgb(" + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + ")"
        }

        var s = [];
        e.requestAnimationFrame = e.requestAnimationFrame || e.webkitRequestAnimationFrame || e.mozRequestAnimationFrame || e.oRequestAnimationFrame || e.msRequestAnimationFrame || function (e) {
          setTimeout(e, 1e3 / 60)
        }, i(".heart{width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;}.heart:after{top: -5px;}.heart:before{left: -5px;}"), n(), r()
      }(window, document);
    </script>
  



  <script>(function (i, s, o, g, r, a, m) {
      i['DaoVoiceObject'] = r;
      i[r] = i[r] ||
        function () {
          (i[r].q = i[r].q || []).push(arguments);
        };
      i[r].l = 1 * new Date();
      a = s.createElement(o);
      m = s.getElementsByTagName(o)[0];
      a.async = 1;
      a.src = g;
      a.charset = 'utf-8';
      m.parentNode.insertBefore(a, m);
    })(window, document, 'script', ('https:' === document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/f4bf9f58.js", 'daovoice');
    daovoice('init', {
      app_id: "f4bf9f58",
    });
    daovoice('update');
  </script>











</body>
</html>
